<?php
include_once "../../includes/template.php";

$sec = 60;
$page = $_SERVER['PHP_SELF'];

if (!authorisedAccess(true, true, true)) {
    header("Location:../../index.php");
    exit;
}

$query = "SELECT Username, Score FROM Users WHERE AccessLevel=1 AND Enabled=1 ORDER BY Score DESC";
$stmt = $conn->prepare($query);
$stmt->execute();
$scores = $stmt->fetchAll(PDO::FETCH_ASSOC);
?>

<div class="wideBox">
    <div class="title">
        <h2 style="font-size: 45px">Leaderboard</h2>
        <div class="table-responsive">
            <div class="container-fluid">
                <div class="row">
                    <div class="leaderboard" style="min-width: 20rem; max-width: 20rem"><strong>Username</strong></div>
                    <div class="leaderboard" style="min-width: 20rem; max-width: 20rem"><strong>Score</strong></div>
                </div>
                <!-- Note that the leaderboard does not include Administrative users -->
                <?php foreach ($scores as $scoreData): ?>
                    <?php if ($scoreData['Score'] != 0): ?>
                        <div class="row">
                            <div class="leaderboard" style="min-width: 300px; max-width: 50%"><?= htmlspecialchars($scoreData['Username']) ?></div>
                            <div class="leaderboard" style="min-width: 30px; max-width: 50%"><?= htmlspecialchars($scoreData['Score']) ?></div>
                        </div>
                    <?php endif; ?>
                <?php endforeach; ?>
            </div>
        </div>
    </div>
</div>